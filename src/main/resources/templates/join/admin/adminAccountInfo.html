<!DOCTYPE html>
<html lang="en">
<head>
    <title>adminAccountInfo</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f8f8f8;
        }

        .container {
            text-align: center;
        }

        .logo {
            margin-bottom: 20px;
        }

        .logo-up {
            font-size: 36px;
            color: #0056b3; /* íŒŒë€ìƒ‰ */
            font-weight: bold;
        }

        .logo-down {
            font-size: 36px;
            color: #39b778; /* ì—°ë‘ìƒ‰ */
            font-weight: bold;
        }

        .login-box {
            background-color: #ffffff;
            width: 400px;
            padding: 30px 40px;
            border: 2px solid #0056b3;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: inline-block;
        }

        .login-title {
            margin-bottom: 20px;
            font-size: 24px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
            align-items: center; /* ì¶”ê°€: ìˆ˜ì§ ì •ë ¬ */
        }

        .form-group input {
            width: 100%; /* ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½ì˜ ë„ˆë¹„ì™€ ì¼ì¹˜ */
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #cccccc;
            font-size: 16px;
            box-sizing: border-box;
        }

        .form-buttons {
            gap: 10px;
        }

        .btn {
            width: 100px; /* ë²„íŠ¼ í¬ê¸°ë¥¼ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½ì˜ ë„ˆë¹„ì— ë§ì¶¤ */
            padding: 10px 0;
            border: none;
            border-radius: 5px;
            background-color: #0056b3;
            color: white;
            font-size: 16px;
            cursor: not-allowed;
            text-transform: uppercase;
        }

        .btn.active {
            background-color: #0056b3; /* í™œì„±í™” ìƒíƒœ ìƒ‰ìƒ */
            cursor: pointer;
        }

        .btn:hover.active {
            background-color: #003f8a;
        }

        .verify-btn {
            width: 100px; /* ì¸ì¦ ë²„íŠ¼ í¬ê¸°ë¥¼ ì¡°ì • */
            padding: 10px 0;
            border: none;
            border-radius: 5px;
            background-color: #cccccc; /* ë¹„í™œì„±í™” ìƒíƒœ ìƒ‰ìƒ */
            color: white;
            font-size: 16px;
            cursor: not-allowed;
            text-transform: uppercase;
        }

        .verify-btn.active {
            background-color: #0056b3; /* í™œì„±í™” ìƒíƒœ ìƒ‰ìƒ */
            cursor: pointer;
        }

        .verify-btn:hover.active {
            background-color: #003f8a;
        }

        #confirmButton:not(.active):hover {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .btn-timer-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap; /* íƒ€ì´ë¨¸ë¡œ ì¸í•´ ë²„íŠ¼ì´ ë°€ë¦¬ì§€ ì•Šë„ë¡ ì¡°ì • */
        }

        #phone {
            width: calc(100% - 110px);
        }

        #verificationCode {
            width: calc(100% - 110px);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #cccccc;
            font-size: 16px;
            box-sizing: border-box;
        }

        .timer {
            font-size: 14px;
            color: red;
        }

        .logo-link {
            text-decoration: none; /* ë°‘ì¤„ ì œê±° */
        }

        .logo-link:hover {
            cursor: pointer; /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ í¬ì¸í„°ë¡œ ë³€ê²½ */
        }

        #empNumButton {
            width: 100px;
            padding: 10px 0;
            border: none;
            border-radius: 5px;
            background-color: #0056b3;
            color: white;
            font-size: 16px;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <a th:href="@{/admin/login}" class="logo-link">
                <span class="logo-up">Up</span><span class="logo-down">Down</span>
            </a>
        </div>
        <div class="login-box">
            <h2 class="login-title">ë“±ë¡</h2>
            <form th:action="@{/admin/register}" method="post">
                <div class="form-group">
                    <input type="text" id="empNum" name="empNum" placeholder="ì‚¬ë²ˆ" required>
                    <button type="button" id="empNumButton">ë“±ë¡ í™•ì¸</button>
                </div>
                <div class="form-group">
                    <input type="password" id="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
                </div>
                <div class="form-group">
                    <input type="tel" id="phone" name="phone" placeholder="ì „í™”ë²ˆí˜¸" required>
                    <div class="btn-timer-wrapper">
                        <button type="button" class="btn verify-btn" id="verifyButton" disabled>ì¸ì¦</button>
                        <span id="timer" class="timer"></span>
                    </div>
                </div>
                <div class="form-group" id="verificationGroup" style="display:none;">
                    <input type="text" id="verificationCode" name="verificationCode" placeholder="ì¸ì¦ë²ˆí˜¸" required>
                    <button type="button" class="btn verify-btn" id="confirmButton" disabled>í™•ì¸</button>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="btn" id="registerButton" disabled>ë“±ë¡í•˜ê¸°</button>
                </div>
            </form>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        let timerInterval; // íƒ€ì´ë¨¸ë¥¼ ì œì–´í•˜ê¸° ìœ„í•œ ë³€ìˆ˜
        let timerExpired = false;
        const phoneNumber = document.getElementById("phone").value.trim();
        let certificationNumber; // ì¸ì¦ ë²ˆí˜¸
        let completeYn = false;
        const registerButton = document.getElementById("registerButton");

        // ì „í™”ë²ˆí˜¸ ì…ë ¥ ì‹œ ì¸ì¦ ë²„íŠ¼ í™œì„±í™”
        document.getElementById("phone").addEventListener("input", function() {
            const verifyButton = document.getElementById("verifyButton");
            if (this.value.length === 11) {
                verifyButton.disabled = false;
                verifyButton.classList.add("active");
                verifyButton.removeAttribute("disabled");
            } else {
                verifyButton.disabled = true;
                verifyButton.classList.remove("active");
            }
        });

        // ì¸ì¦ë²ˆí˜¸ ì…ë ¥ ì‹œ í™•ì¸ ë²„íŠ¼ í™œì„±í™”
        document.getElementById("verificationCode").addEventListener("input", function() {
            const confirmButton = document.getElementById("confirmButton");
            if (this.value.length === 6) {
                confirmButton.disabled = false;
                confirmButton.classList.add("active");
                confirmButton.removeAttribute("disabled");
            } else {
                confirmButton.disabled = true;
                confirmButton.classList.remove("active");
            }
        });

        document.getElementById("verifyButton").addEventListener("click", function() {
            if(!timerExpired) {
                timerExpired = false;
                completeYn = false;
                registerButton.disabled = true;
                registerButton.classList.remove("active");
                this.textContent = "ì¬ì¸ì¦";
                document.getElementById("confirmButton").disabled = false;
                if(document.getElementById("verificationCode").value.length === 6) {
                    document.getElementById("confirmButton").classList.add("active");
                }
                document.getElementById("verificationGroup").style.display = "flex";

                // ê¸°ì¡´ íƒ€ì´ë¨¸ë¥¼ ì´ˆê¸°í™”
                clearInterval(timerInterval);
                startTimer(3 * 60, document.getElementById("timer")); // 3ë¶„ íƒ€ì´ë¨¸ ì‹œì‘

                const csrfHeader = "[[${_csrf.headerName}]]";
                const csrfToken = "[[${_csrf.token}]]";
                const headers = {
                    [csrfHeader] : csrfToken
                }

                $.ajax({
                    url: '/admin/sign/send',
                    type: 'POST',
                    headers,
                    data: { phoneNum : phoneNumber },
                    success: function (response) {
                        console.log("POST response:", response);
                        const {result, resultNum} = response;
                        if(result === 'success')
                            certificationNumber = resultNum;
                    },
                    error: function (error) {
                        console.error("Error with POST request:", error);
                    }
                });
            }
        });

        document.getElementById("confirmButton").addEventListener("click", function() {
            const checkNum = document.getElementById('verificationCode').value.trim();

            if (!timerExpired) {
                if (certificationNumber === checkNum) {
                    alert("ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    completeYn = true;
                    clearInterval(timerInterval);
                    document.getElementById("confirmButton").disabled = true;
                    document.getElementById("confirmButton").classList.remove("active");

                    // ë“±ë¡í•˜ê¸° ë²„íŠ¼ í™œì„±í™”
                    registerButton.disabled = false;
                    registerButton.classList.add("active");
                } else if(certificationNumber !== checkNum){
                    alert("ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì¸ì¦í•´ì£¼ì„¸ìš”.");
                } else {
                    alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì¸ì¦í•´ì£¼ì„¸ìš”.");
                }
            } else {
                alert("ì¸ì¦ ì‹œê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì¸ì¦í•´ì£¼ì„¸ìš”.");
            }
        });

        function startTimer(duration, display) {
            let timer = duration, minutes, seconds;
            timerInterval = setInterval(() => {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                display.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    timerExpired = true;
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

        document.getElementById("empNumButton").addEventListener("click", function() {
            const empNumber = document.getElementById("empNum").value.trim();
            const csrfHeader = "[[${_csrf.headerName}]]";
            const csrfToken = "[[${_csrf.token}]]";
            const headers = {
                [csrfHeader] : csrfToken
            }

            $.ajax({
                url: '/admin/check',
                type: 'POST',
                headers,
                data: { empNum : empNumber },
                success: function (response) {
                    // console.log("POST response:", response);
                    if(response.result === "empty") {
                        alert("ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤ğŸˆ");
                    } else if(response.result === "registered") {
                        alert("ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤ğŸ¡ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤ğŸˆ");
                        location.href="/admin/login";
                    } else {
                        alert("ë“±ë¡ëœ ì‚¬ë²ˆì´ ì—†ìŠµë‹ˆë‹¤. ì‚¬ë²ˆì˜ ì •ë³´ê°€ ì¼ì¹˜í•œì§€ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    }
                },
                error: function (error) {
                    console.error("Error with POST request:", error);
                }
            });
        });
    </script>
</body>
</html>
